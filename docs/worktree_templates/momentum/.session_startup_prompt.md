# Momentum Strategies Development Track - Session 2

**Branch:** `feature/strategies-momentum`
**Session:** MOMENTUM-2
**Previous Session:** MOMENTUM-1 (January 8, 2026)
**Use VBT 5-Step Workflow:** MANDATORY for all implementations

---

## Session 1 Summary

**Key Discovery:** Both strategies are 95% COMPLETE (not skeleton as documented)
- Quality-Momentum: 36/36 tests passing, backtest script created
- Semi-Vol Momentum: Algorithm complete, needs test suite

**Blocker:** VBT MCP token issue - `search`, `find`, `find_docs` fail
- Token in .env but MCP server not recognizing
- Workaround: Use `phelp()` and `run_code()` instead

**Initial Backtest Results (Synthetic Data):**
- CAGR: 26.33% | Sharpe: 0.84 | Max DD: -42.59%

---

## Session 2 Priorities

1. **Fix VBT MCP Token** - Verify GitHub token works
2. **Complete VBT 5-Step TEST** - Run multi-asset portfolio test
3. **Walk-Forward Validation** - Target <30% Sharpe degradation
4. **Monte Carlo Simulation** - Target P(Loss) < 20%

---

## Session Protocol

1. **Read First:**
   - `docs/HANDOFF.md` (updated with Session 1 results)
   - `docs/CLAUDE.md` (development rules)

2. **Use VBT MCP Tools:**
   - `mcp__vectorbt-pro__search` - Find patterns
   - `mcp__vectorbt-pro__resolve_refnames` - Verify methods exist
   - `mcp__vectorbt-pro__find` - Find usage examples
   - `mcp__vectorbt-pro__run_code` - Test implementations

3. **Run Tests Frequently:**
   ```bash
   uv run pytest tests/test_strategies/test_quality_momentum.py -v
   uv run pytest tests/test_strategies/test_semi_vol_momentum.py -v
   ```

---

## Strategy 1: Quality-Momentum (PHASE 1 PRIORITY)

**File:** `strategies/quality_momentum.py`
**Status:** SKELETON with signal generation logic
**Tests:** Augment existing `tests/test_strategies/test_quality_momentum.py` (33 tests exist)
**Data Source:** Alpha Vantage (fundamental data with 90-day caching via `integrations/alphavantage_fundamentals.py`)

### Implementation Tasks

1. **Complete `_generate_portfolio_signals()` (CRITICAL)**
   - Cross-sectional ranking across universe
   - Quality score calculation: 40% ROE + 30% accruals + 30% inverse leverage
   - 12-1 momentum calculation (12-month return, 1-month lag)

2. **Quarterly Rebalance Date Detection**
   - Detect quarter-end dates
   - Trigger rebalance logic on those dates
   - Handle partial quarters at backtest edges

3. **Quality Filter Implementation**
   - Remove bottom 50% by quality score
   - Then rank remaining by momentum
   - Select top 50% of quality-filtered stocks

4. **Exit Logic**
   - Quarterly rebalance refresh
   - Quality/momentum rank drop below 40% (buffer zone)

5. **Validation**
   - Walk-forward validation (<30% degradation)
   - Monte Carlo simulation (P(Loss) < 20%)

### Performance Targets
| Metric | Target | Threshold |
|--------|--------|-----------|
| Sharpe | 1.3-1.7 | > 1.2 |
| CAGR | 15-22% | > 12% |
| Max DD | -18% to -22% | < -25% |
| Turnover | 50-80% quarterly | < 100% |

### Regime Compatibility (UNIQUE - All Regimes)
| Regime | Allocation | Note |
|--------|-----------|------|
| TREND_BULL | 25-30% | Momentum enhances returns |
| TREND_NEUTRAL | 30-35% | Quality protects |
| TREND_BEAR | 20-30% | DEFENSIVE - quality prevents blow-up |
| CRASH | 10-15% | Only highest quality if any |

---

## Strategy 2: Semi-Volatility Momentum (PHASE 2)

**File:** `strategies/semi_vol_momentum.py`
**Status:** SKELETON with volatility scaling logic
**Tests:** Create `tests/test_strategies/test_semi_vol_momentum.py` (~25 tests)

### Implementation Tasks

1. **Volatility Scalar Formula (Moreira & Muir)**
   - `position_size = base_size * (target_vol / realized_vol)`
   - Clip to 0.5x - 2.0x range
   - Target volatility: 15% annualized

2. **Regime Filter Integration**
   - TREND_BULL only
   - Only trade when market vol < 18%

3. **Circuit Breaker Implementation**
   - Exit all positions if portfolio vol > 22%
   - Real-time volatility monitoring

4. **Test Suite Creation**
   - ~25 tests covering all edge cases
   - Volatility spike scenarios
   - Regime transition handling

5. **Validation**
   - Walk-forward with 2008/2020 stress testing
   - Monte Carlo simulation

### Performance Targets
| Metric | Target | Threshold |
|--------|--------|-----------|
| Sharpe | 1.4-1.8 | > 1.2 |
| CAGR | 15-20% | > 12% |
| Max DD | -15% to -20% | < -25% |
| Turnover | ~100% annually | < 150% |

### Regime Compatibility
| Regime | Allocation | Note |
|--------|-----------|------|
| TREND_BULL + Low Vol | 15-20% | Ideal conditions |
| TREND_BULL + High Vol | 5-10% | Reduced due to scaling |
| TREND_NEUTRAL | 0% | Sit out |
| TREND_BEAR | 0% | Sit out |
| CRASH | 0% | Risk-off |

---

## Files to Create

```
tests/test_strategies/test_semi_vol_momentum.py  # ~25 tests (NEW)
scripts/backtest_quality_momentum.py              # Full backtest
scripts/backtest_semi_vol_momentum.py             # Full backtest
integrations/alphavantage_fundamentals.py         # Fundamental data fetcher (if not exists)
```

---

## Session Handoff

After each session, create:
`docs/session_handoffs/TRACK_MOMENTUM_SESSION_{n}.md`

Include: tasks completed, test results, blockers, next steps, cross-track notes.

---

## LOCKED FILES (DO NOT MODIFY)

- `strategies/base_strategy.py` - Core contract
- `utils/position_sizing.py` - Shared infrastructure
- `utils/portfolio_heat.py` - Shared infrastructure
- `regime/academic_jump_model.py` - Layer 1 production

---

## Exclusive Files (Only This Track Modifies)

- `strategies/quality_momentum.py`
- `strategies/semi_vol_momentum.py`
- `tests/test_strategies/test_quality_momentum.py`
- `tests/test_strategies/test_semi_vol_momentum.py`
- `scripts/backtest_quality_momentum.py`
- `scripts/backtest_semi_vol_momentum.py`

---

## OpenMemory Queries

For context on momentum strategies:
- "Quality-Momentum strategy implementation VBT"
- "Semi-volatility momentum Moreira Muir"
- "ATLAS strategy validation walk-forward"
