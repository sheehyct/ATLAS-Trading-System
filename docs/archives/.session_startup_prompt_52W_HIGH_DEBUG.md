# Session Startup Context - ATLAS Trading System

**Last Session:** 34 (November 14, 2025)
**Current Phase:** Layer 1 (ATLAS) complete, Foundation Strategy (52W High Momentum) implemented with CRITICAL ISSUE
**Branch:** main

## Current State

**Layer 1 (ATLAS) - VALIDATED:**
- Test results: 48/63 passing (76%)
- March 2020 crash detection: 77% (exceeds 50% target)
- Lambda recalibrated to 1.5 (optimal for z-score features)
- Declared sufficient for production based on real-world validation

**Layer 2 (STRAT) - COMPLETE:**
- Phase 1 (Bar Classification): 14/14 tests passing (100%)
- Phase 2 (Pattern Detection): 16/16 tests passing (100%)
- Phase 3 (ATLAS Integration): 26/26 tests passing (100%)
- **Total: 56/56 tests passing (100%)**
- Backtest Results (SPY 2020-2024): Sharpe 1.11, MaxDD -0.21%, Return 28.56%

**Foundation Strategies (Session 34) - IMPLEMENTATION STARTED:**
- 52-Week High Momentum: IMPLEMENTED with CRITICAL ISSUE
  - Strategy class: strategies/high_momentum_52w.py (328 lines)
  - Tests: 26/27 passing (96%), tests/test_strategies/test_high_momentum_52w.py (600+ lines)
  - Backtest script: backtest_52w_high.py (308 lines)
  - **CRITICAL ISSUE:** Only 3 trades in 20 years on SPY 2005-2025 (expected hundreds)
  - Performance: Sharpe 0.50 vs 0.8-1.2 target, CAGR 5.94% vs 10-15% target
  - Root cause hypothesis: Volume confirmation (2.0x threshold) too restrictive

**Documentation (Session 34):**
- HANDOFF.md: Updated with Session 34 summary (now includes signal generation issue)
- .session_startup_prompt.md: Updated for Session 35 priorities
- Session 34 context stored in OpenMemory

## Session 34 Accomplishments

**52-Week High Momentum Strategy Implemented:**
- Created strategies/high_momentum_52w.py (328 lines)
- Academic foundation: Novy-Marx (2012), George & Hwang (2004)
- Entry: Distance >= 0.90 from 52-week high + 2.0x volume confirmation
- Exit: Distance < 0.70 (30% off highs)
- ATR-based position sizing with 2% risk per trade

**Comprehensive Test Suite:**
- Created tests/test_strategies/test_high_momentum_52w.py (600+ lines)
- 27 tests covering all strategy aspects (26/27 passing, 96%)
- Categories: initialization, signal generation, regime filtering, volume confirmation, position sizing, edge cases

**Backtest Validation Script:**
- Created backtest_52w_high.py (308 lines)
- SPY 2005-2025 historical data via Yahoo Finance
- Compares strategy vs buy-and-hold benchmark
- Validates against architecture performance targets

**CRITICAL ISSUE Discovered:**
- Only 3 trades generated in 20 years (expected hundreds)
- Sharpe 0.50 vs 0.8-1.2 target (FAIL)
- CAGR 5.94% vs 10-15% target (FAIL)
- Hypothesis: Volume confirmation (2.0x threshold) too restrictive

**Files Created:**
1. strategies/high_momentum_52w.py (328 lines)
2. tests/test_strategies/test_high_momentum_52w.py (600+ lines)
3. backtest_52w_high.py (308 lines)

**Files Modified:**
- docs/HANDOFF.md (Session 34 summary added)
- .session_startup_prompt.md (updated for Session 35)

## Session 35 Immediate Priorities

**CRITICAL: Debug 52-Week High Momentum Signal Generation**

**Immediate Task:** Identify why backtest generates only 3 trades in 20 years (expected hundreds)

**Debug Plan:**

1. **Create Debug/Inspection Script:**
   - Load SPY data 2005-2025
   - Calculate all signal components:
     - 52-week high (252-day rolling max)
     - Distance from high (close / 52w_high)
     - Volume MA (20-day)
     - Volume confirmation (volume > 2.0x MA)
     - Entry signal (distance >= 0.90 & volume_confirmed)
     - Exit signal (distance < 0.70)
   - Export CSV: date, close, high_52w, distance, volume, volume_ma, volume_confirmed, entry_signal, exit_signal
   - Calculate statistics:
     - % of days with distance >= 0.90 (near 52w high)
     - % of days with volume > 2.0x MA (volume surge)
     - % of days with BOTH conditions (entry signal)
     - Total entry signals over 20 years

2. **Test Hypotheses:**
   - Hypothesis 1: Volume confirmation too restrictive (2.0x threshold blocks most entries)
     - Check: How many days meet distance >= 0.90 WITHOUT volume filter?
     - Check: How many days meet volume > 2.0x MA WITHOUT distance filter?
     - Check: Overlap between both conditions
   - Hypothesis 2: Entry and exit signals overlap (preventing trades)
     - Check: Do entry and exit signals fire on same day?
     - Check: Does exit fire immediately after entry?
   - Hypothesis 3: Position sizing returns 0 shares
     - Check: Position sizes in backtest (are they all zero?)
     - Check: Capital constraints preventing trades

3. **Research Volume Threshold:**
   - Review academic papers: Is 2.0x threshold appropriate for 52-week high strategy?
   - Novy-Marx (2012) and George & Hwang (2004) - do they specify volume requirements?
   - Consider relaxing to 1.5x if research supports it

4. **Fix and Re-test:**
   - Implement fix based on root cause
   - Re-run backtest on SPY 2005-2025
   - Validate performance meets targets (Sharpe >= 0.8, CAGR >= 10%)
   - If successful, proceed to integration with regime allocator

**Decision Point:**
If signal generation cannot be fixed to meet architecture targets:
- Consider alternative foundation strategies (Quality-Momentum, Relative Strength)
- Reassess 52-Week High Momentum viability for ATLAS system
- Document learnings in OpenMemory

## Files to Read First (Next Session)

1. **docs/HANDOFF.md** - Session 34 summary (lines 45-230)
2. **.session_startup_prompt.md** - Session 35 debug plan
3. **strategies/high_momentum_52w.py** - Strategy implementation to debug
4. **backtest_52w_high.py** - Backtest script showing 3 trades issue
5. **docs/CLAUDE.md** - Development standards and workflows

## Development Standards

- Read HANDOFF.md first (mandatory)
- NO unicode/emojis in any output
- 5-step VBT verification workflow for VBT code (SEARCH → VERIFY → FIND → TEST → IMPLEMENT)
- Professional git commits (no AI attribution)
- Query OpenMemory for context before assumptions
- Use STRAT skill for STRAT-related guidance

## Session 34 Success Criteria - PARTIAL

**Completed:**
- 52-Week High Momentum strategy implemented (strategies/high_momentum_52w.py, 328 lines)
- Comprehensive test suite created (26/27 tests passing, 96%)
- Backtest validation script created (backtest_52w_high.py, 308 lines)
- HANDOFF.md updated with Session 34 summary
- Session context prepared for Session 35

**NOT Completed (Session 35 Priorities):**
- Signal generation debugging (only 3 trades in 20 years)
- Performance targets NOT met (Sharpe 0.50 vs 0.8-1.2, CAGR 5.94% vs 10-15%)
- Root cause identification required
- Fix and validation required before proceeding

## Critical Context for Session 35

**DO NOT:**
- Proceed to additional strategies before fixing 52W High signal generation
- Skip CSV export and manual inspection of signals
- Guess at root cause without data evidence
- Relax volume threshold without research justification
- Proceed to paper trading with broken strategy

**DO:**
- Create debug script to inspect signal generation on real data
- Export CSV with all signal components for manual inspection
- Test each hypothesis systematically with evidence
- Research academic papers for volume threshold guidance
- Fix root cause and re-validate against targets
- Document findings in OpenMemory for future reference

**Expected Session 35 Duration:** 2-3 hours (debugging and fixing)

**Success Criteria for Session 35:**
- Identify root cause of low trade count (3 trades in 20 years)
- Implement fix based on data evidence
- Re-run backtest and validate performance meets targets:
  - Sharpe Ratio >= 0.8 (minimum acceptable)
  - CAGR >= 10% (minimum acceptable)
  - Max Drawdown <= -30% (maximum acceptable)
- If targets met: Proceed to regime integration
- If targets NOT met: Reassess strategy viability and consider alternatives
- Update HANDOFF.md with Session 35 summary and findings
