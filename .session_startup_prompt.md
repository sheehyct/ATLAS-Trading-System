# ATLAS Development - Session Startup

**Current Session:** CRYPTO-7
**Last Session:** CRYPTO-6 (December 14, 2025)
**Focus:** Live trading mode, position exit tracking, performance analytics

---

## Session CRYPTO-6 Accomplishments

### REST API (COMPLETE)

Flask API running as daemon thread on port 8080.

**Endpoints:**
- `/health` - Daemon status check
- `/status` - Full daemon status
- `/positions` - Open positions with P&L
- `/signals` - Pending SETUP signals
- `/performance` - Account summary + metrics
- `/trades` - Trade history

**Key Files:**
| File | Purpose |
|------|---------|
| `crypto/api/__init__.py` | Module init |
| `crypto/api/server.py` | Flask REST API (~232 LOC) |

### Dashboard Integration (COMPLETE)

New "Crypto Trading" tab in dashboard.

**Features:**
- Account summary: balance, P&L, return %
- Daemon status: running, leverage tier, scan counts
- Open positions with unrealized P&L
- Pending signals tab
- Closed trades tab with summary
- Performance metrics tab
- 30-second auto-refresh

**Key Files:**
| File | Purpose |
|------|---------|
| `dashboard/data_loaders/crypto_loader.py` | API client (~311 LOC) |
| `dashboard/components/crypto_panel.py` | Panel component (~1012 LOC) |

### Deployment Pending

**VPS (requires manual steps):**
```bash
ssh atlas@178.156.223.251
cd ~/vectorbt-workspace && git pull
sudo ufw allow 8080/tcp
sudo systemctl restart atlas-crypto-daemon
curl http://localhost:8080/health
```

**Railway:**
- Add env var: `CRYPTO_API_URL=http://178.156.223.251:8080`
- Push to main (auto-deploys)

---

## Session CRYPTO-7 Priorities

### Priority 1: Live Trading Mode (HIGH)

Enable execution in daemon (currently signals-only mode).

**Tasks:**
- Test paper trading execution flow
- Verify position sizing with leverage
- Monitor exits via stop/target

### Priority 2: Position Exit Tracking (MEDIUM)

Track stop/target hits in dashboard.

**Tasks:**
- Add exit history to closed trades
- Show exit reason (STOP/TARGET/MANUAL)
- Track time to exit

### Priority 3: Performance Analytics (LOW)

Aggregate crypto P&L metrics.

**Tasks:**
- Calculate win rate by timeframe
- Calculate profit factor by pattern
- Add time-based analysis

---

## Crypto Module Structure (v0.6.0)

```
crypto/
  __init__.py              # v0.6.0
  api/                     # NEW - Session CRYPTO-6
    __init__.py            # Module init
    server.py              # Flask REST API (port 8080)
  config.py                # Leverage tiers, timeframes
  alerters/
    __init__.py            # NEW
    discord_alerter.py     # CryptoDiscordAlerter (NEW)
  exchange/
    coinbase_client.py     # Coinbase API
  data/
    state.py               # CryptoSystemState
  scanning/
    models.py              # CryptoDetectedSignal
    signal_scanner.py      # CryptoSignalScanner
    entry_monitor.py       # CryptoEntryMonitor (on_poll)
    daemon.py              # CryptoSignalDaemon (Discord)
  simulation/
    paper_trader.py        # PaperTrader
    position_monitor.py    # CryptoPositionMonitor
  trading/
    sizing.py              # Position sizing
    derivatives.py         # Funding, margin
```

---

## Plan Mode Recommendation

**PLAN MODE: ON** - Dashboard integration requires architectural planning.

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- Daemon: `crypto/scanning/daemon.py`
- CLI: `scripts/run_crypto_daemon.py`
- Discord Alerter: `crypto/alerters/discord_alerter.py`

---

## Session Numbering

- **83K-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
