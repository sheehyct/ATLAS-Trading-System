# Session Startup Prompt - EQUITY-95

**Previous Session:** EQUITY-94 (January 27, 2026)
**Current Branch:** `main`
**VPS Status:** Running - EQUITY-94 code deployed, crypto daemon restarted
**Plan Mode:** OFF (bug fixes with clear scope)

---

## EQUITY-94 Accomplishments

1. **Phase 6.4 - Coordinator Extraction COMPLETE**
   - Extracted 5 coordinators from CryptoSignalDaemon (1,818 -> 1,172 lines, 35.5% reduction)
   - CryptoHealthMonitor (212), CryptoEntryValidator (287), CryptoStatArbExecutor (348),
     CryptoFilterManager (159), CryptoAlertManager (179)
   - 824/824 crypto tests passing, backward compat delegates preserve test API

2. **VPS Deployed** - Git pull + crypto daemon restart, clean startup confirmed

3. **Discord Audit Bug Investigated** (not yet fixed)
   - Audit reads stale `paper_trades.json` (Dec 2025) instead of Alpaca API
   - `AlpacaTradingClient.get_closed_trades()` already exists but isn't wired to audit
   - EOD exits running after market hours (spam retrying every minute)

---

## EQUITY-95 Priorities

### Priority 1: Fix Equities EOD Exit After-Hours Bug (CRITICAL)

EOD exits spam Alpaca after market close (9:35 PM ET+), getting rejected every minute.
Positions that should exit at 3:59 PM ET instead exit next morning = unnecessary theta decay.

Root cause: `exit_evaluator.py` triggers EOD exits, `position_monitor.py` bypasses market hours
check for EOD (EQUITY-45 change), but after-hours Alpaca rejects options orders.

Fix: Add market-hours guard that still allows 3:55-4:00 PM ET window but blocks after 4:00 PM.

### Priority 2: Fix Discord Audit Data Source

`daemon.py:1083` reads `paper_trades/paper_trades.json` (stale, 4 PENDING trades from Dec 2025).
Should call `self.executor._trading_client.get_closed_trades(after=today_start)` instead.
The Alpaca client already has FIFO matching logic returning realized_pnl.

### Priority 3: Phase 6.5 - Dashboard Strategy Filter

Add strategy selector to crypto dashboard for separate P/L tracking.

---

## Phase 6 Progress

| Phase | Description | Status |
|-------|-------------|--------|
| 6.1 | Strategy field addition | COMPLETE |
| 6.2 | StatArb signal generator | COMPLETE |
| 6.3 | Daemon integration | COMPLETE |
| 6.4 | Coordinator extraction | COMPLETE |
| 6.5 | Dashboard filter | PENDING |

---

## Code Simplification Backlog (from EQUITY-94 review)

1. Remove backward-compat delegates from daemon.py (~76 lines) - update tests to call coordinators directly
2. Consolidate `_execute_trade` / `_execute_triggered_pattern` duplication (~100 lines)

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- CLAUDE.md: `docs/CLAUDE.md` (STRICT COMPLIANCE)
- Dashboard work: `docs/DASHBOARD_HANDOFF.md` (separate DB-x sessions)
