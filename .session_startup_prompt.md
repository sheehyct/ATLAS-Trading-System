# Session Startup Prompt - EQUITY-90

**Previous Session:** EQUITY-89 (January 25, 2026)
**Current Branch:** `main`
**VPS Status:** Running - 4H TFC fix deployed (b36ce97)
**Plan Mode:** OFF (implementation ready)

---

## EQUITY-89 Accomplishments

1. **Completed Phase 3.2 - StaleSetupValidator Extraction**
   - Created `strat/signal_automation/coordinators/stale_setup_validator.py` (292 lines)
   - StalenessConfig dataclass for configurable thresholds
   - Staleness windows: 1H (1.5hr), 4H (4hr), 1D (2 trading days), 1W (2 weeks), 1M (2 months)
   - daemon.py reduced: 1,512 -> 1,444 lines (-68 lines)
   - 26 new tests

2. **Applied 4H TFC Fix**
   - Root cause: Missing `4H` key in TFC requirements dict
   - Added `4H` to `timeframe_requirements` and `timeframe_min_strength`
   - Crypto can now trade on all timeframes (was 4HR-only)
   - Commit: `b36ce97`

3. **GOAL ACHIEVED: daemon.py < 1,500 lines**
   - Final: 1,444 lines (target was <1,500)
   - Total extracted: 2,096 lines across 6 coordinators
   - Total tests added: 226 for coordinators

4. **Archived Sessions EQUITY-61 to EQUITY-84**
   - Created: `docs/session_archive/sessions_EQUITY-61_to_EQUITY-84.md`
   - HANDOFF.md reduced from 1,773 to 345 lines

---

## EQUITY-90 Priorities

### Priority 1: Begin Phase 4 - PositionMonitor Extractions

PositionMonitor.py is the next god class (1,572 lines). Extract:
- 4.1 ExitConditionEvaluator (Lines 619-836, ~220 lines)
- 4.2 TrailingStopManager (Lines 856-1084, ~230 lines)
- 4.3 PartialExitManager (Lines 1085-1134, ~50 lines)

Target: PositionMonitor.py from 1,572 lines to <1,200 lines

### Priority 2: VPS Deployment

Deploy StaleSetupValidator + 4H TFC fix to VPS if not already done.

### Priority 3: Code Review

Run `/code-review` on EQUITY-89 extractions before proceeding.

---

## Phase 4 Summary

| Phase | Coordinator | Lines | Tests | Status |
|-------|-------------|-------|-------|--------|
| 1.1 | AlertManager | 254 | 22 | COMPLETE |
| 1.2 | HealthMonitor | 291 | 30 | COMPLETE |
| 1.3 | MarketHoursValidator | 298 | 41 | COMPLETE |
| 2.1 | FilterManager | 401 | 59 | COMPLETE |
| 3.1 | ExecutionCoordinator | 560 | 48 | COMPLETE |
| 3.2 | StaleSetupValidator | 292 | 26 | COMPLETE |
| **Total** | - | **2,096** | **226** | |

### God Class Progress

| File | Original | Current | Goal |
|------|----------|---------|------|
| daemon.py | 2,042 | 1,444 | <1,500 ACHIEVED |
| position_monitor.py | 1,572 | 1,572 | <1,200 (next) |
| crypto_daemon.py | 1,501 | 1,501 | <1,200 (Phase 6) |

---

## Deferred Work: Phase 6

**Spot Signal / Derivative Execution Architecture** (from EQUITY-89):
- Use SPOT data for pattern detection, execute on DERIVATIVES
- Changes touch files Phase 6 will refactor anyway
- Added to plan file for Phase 6 (crypto daemon refactoring)

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- CLAUDE.md: `docs/CLAUDE.md` (STRICT COMPLIANCE)
- Phase 4 Plan: `C:\Users\sheeh\.claude\plans\transient-percolating-mist.md`
- Archive: `docs/session_archive/sessions_EQUITY-61_to_EQUITY-84.md`
