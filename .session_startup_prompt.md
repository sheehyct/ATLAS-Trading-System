# Mean Reversion Strategies Development Track

**Branch:** `feature/strategies-reversion`
**Scope:** IBS Mean Reversion + ORB modifications
**Use VBT 5-Step Workflow:** MANDATORY for all implementations

---

## Session Protocol

1. **Read First:**
   - `docs/SYSTEM_ARCHITECTURE/1_ATLAS_OVERVIEW_AND_PROPOSED_STRATEGIES.md`
   - `strategies/base_strategy.py` (the contract to implement)
   - `docs/CLAUDE.md` (development rules)

2. **Use VBT MCP Tools:**
   - `mcp__vectorbt-pro__search` - Find patterns
   - `mcp__vectorbt-pro__resolve_refnames` - Verify methods exist
   - `mcp__vectorbt-pro__find` - Find usage examples
   - `mcp__vectorbt-pro__run_code` - Test implementations

3. **Run Tests Frequently:**
   ```bash
   uv run pytest tests/test_strategies/test_ibs_mean_reversion.py -v
   uv run pytest tests/test_strategies/test_orb.py -v
   ```

---

## Strategy 1: IBS Mean Reversion

**File:** `strategies/ibs_mean_reversion.py`
**Status:** SKELETON with signal generation
**Tests:** Create `tests/test_strategies/test_ibs_mean_reversion.py`

### Implementation Tasks

1. **Time-Based Exit (CRITICAL)**
   - 3-day maximum hold period
   - Options for implementation:
     a. VBT `exit_after` parameter (preferred)
     b. Custom callback
     c. Post-process trades
   - See TODO in existing skeleton

2. **Volume Confirmation**
   - 2.0x 20-day average volume required
   - Add daily dollar volume filter ($50M minimum)

3. **Concurrent Position Limit**
   - Max 3 positions per architecture spec
   - Integrate with `utils/portfolio_heat.py`

4. **Validation**
   - Walk-forward validation
   - Monte Carlo simulation

### Performance Targets
| Metric | Target | Threshold |
|--------|--------|-----------|
| Sharpe | 1.5-2.0 | > 1.2 |
| Win Rate | 65-75% | > 60% |
| Avg Hold | 1-3 days | < 5 days |
| Max DD | -10% to -12% | < -15% |

---

## Strategy 2: ORB Modifications

**File:** `strategies/orb.py`
**Status:** COMPLETE but needs architecture modifications
**Tests:** Create `tests/test_strategies/test_orb.py`

### Modification Tasks (Per Architecture Spec)

1. **Transaction Cost Analysis**
   - Model 0.15-0.25% per trade explicitly
   - Create sensitivity analysis script
   - Determine viability threshold

2. **S&P 500 Restriction**
   - Currently trades SPY only
   - Add universe validation for S&P 500 constituents only

3. **Regime Filter Integration**
   - Add TREND_BULL only filter
   - Use `should_trade_in_regime()` method

4. **Volume Confirmation**
   - 2.0x already implemented
   - Ensure it CANNOT be disabled

5. **Validation**
   - Walk-forward validation
   - Transaction cost sensitivity analysis

### Performance Targets
| Metric | Target | Threshold |
|--------|--------|-----------|
| Sharpe | > 2.0 | > 1.5 |
| R:R Ratio | > 3:1 | > 2:1 |
| Net Expectancy | > 0.5% | > 0.3% |

---

## Files to Create

```
tests/test_strategies/test_ibs_mean_reversion.py  # ~30 tests
tests/test_strategies/test_orb.py                 # ~30 tests
scripts/backtest_ibs_mean_reversion.py            # Full backtest
scripts/orb_transaction_cost_analysis.py          # Cost sensitivity
```

---

## Session Handoff

After each session, create:
`docs/session_handoffs/TRACK_REVERSION_SESSION_{n}.md`

Include: tasks completed, test results, blockers, next steps.

---

## LOCKED FILES (DO NOT MODIFY)

- `strategies/base_strategy.py` - Core contract
- `utils/position_sizing.py` - Shared infrastructure
- `utils/portfolio_heat.py` - Shared infrastructure
- `regime/academic_jump_model.py` - Layer 1 production

---

## Exclusive Files (Only This Track Modifies)

- `strategies/ibs_mean_reversion.py`
- `strategies/orb.py`
- `tests/test_strategies/test_ibs_mean_reversion.py`
- `tests/test_strategies/test_orb.py`
- `scripts/backtest_ibs_mean_reversion.py`
- `scripts/orb_transaction_cost_analysis.py`
