# Session Startup Prompt - EQUITY-49

**Previous Session:** EQUITY-48 (January 8, 2026)
**Current Branch:** `main`
**VPS Status:** Pending deployment with P3+P4 improvements

---

## Context

### What Was Accomplished (EQUITY-48)

**P3: Type 3 Evolution Detection COMPLETE:**
- Added `intrabar_high` and `intrabar_low` fields to TrackedPosition
- Real-time Type 3 detection using accumulated price extremes since entry
- Fallback to bar_cache if intrabar tracking not initialized
- Added logging for fallback conditions
- 7 new tests in TestIntrabarType3Detection class

**P4: Signal Lifecycle Tracing COMPLETE:**
- Added signal_key to all exit logs in position_monitor.py
- Added signal_key to TRIGGER and INVALIDATED logs in entry_monitor.py
- Full signal traceability from detection to exit

**Files Modified:**
- `strat/signal_automation/position_monitor.py` - intrabar tracking + signal_key logs
- `strat/signal_automation/executor.py` - Clarified entry_bar_high/low naming
- `strat/signal_automation/entry_monitor.py` - signal_key in trigger logs
- `tests/test_signal_automation/test_pattern_invalidation.py` - 7 new tests

**Test Results:** 392 passed (44 signal automation + 348 STRAT)

---

## EQUITY-49 Priorities

### P5: TFC Re-evaluation at Entry (4 hrs)

**Goal:** Re-check TFC alignment when trigger is hit, not just at detection time

**Background:** Currently TFC is evaluated once at pattern detection. By the time entry triggers (could be hours/days later), TFC alignment may have changed. Entry should only proceed if TFC still supports the trade.

**Implementation:**
1. Add TFC re-evaluation in entry_monitor.py or daemon.py `_on_entry_triggered()`
2. Store original TFC score vs entry-time TFC score
3. Log TFC comparison for audit trail
4. Option: Exit if TFC flipped against position after entry

**Files:**
- `strat/signal_automation/daemon.py` - `_on_entry_triggered()` method
- `strat/timeframe_continuity_adapter.py` - TFC calculation
- `strat/paper_signal_scanner.py` - TFC evaluation at detection

### P6: Trade Analytics Dashboard (3 hrs)

**Goal:** Stats by pattern type, TFC score, timeframe

**Implementation:**
- Add pattern type, TFC score, timeframe columns to closed trades table
- Aggregate P&L stats by category
- Win rate by pattern type, timeframe

**Files:**
- `dashboard/components/options_panel.py` - Closed trades table
- `strat/signal_automation/executor.py` - Execution data

---

## Technical Debt Summary

| Priority | Task | Status |
|----------|------|--------|
| P1 | TFC Logging | DONE (EQUITY-47) |
| P2 | Filter Rejection Logging | DONE (EQUITY-47) |
| P3 | Type 3 Evolution Detection | DONE (EQUITY-48) |
| P4 | Signal Lifecycle Tracing | DONE (EQUITY-48) |
| P5 | TFC Re-evaluation at Entry | Next |
| P6 | Trade Analytics Dashboard | Next |

---

## Key Files

- `strat/signal_automation/position_monitor.py` - Pattern invalidation (P3 complete)
- `strat/signal_automation/entry_monitor.py` - Entry monitoring (P4 complete)
- `strat/signal_automation/daemon.py` - Entry triggered callback (P5 target)
- `dashboard/components/options_panel.py` - Dashboard (P6 target)

---

## Plan File

`C:\Users\sheeh\.claude\plans\twinkling-sauteeing-treehouse.md`

---

## Mandatory Workflow

### During Development
1. **CLAUDE.md Section 2:** Invoke `strat-methodology` skill for ANY STRAT-related work
2. **CLAUDE.md Section 3:** Run tests before claiming functionality works

### Pre-Commit Checklist (BEFORE every commit)
- [ ] Run `/code-review` on changed files
- [ ] If touching trade execution code: Run `pr-review-toolkit:silent-failure-hunter`
- [ ] If adding new functionality: Run `pr-review-toolkit:pr-test-analyzer`
- [ ] Tests pass locally

### Session End Protocol
- [ ] Update docs/HANDOFF.md
- [ ] Update .session_startup_prompt.md
- [ ] Store session facts in OpenMemory
- [ ] Provide summary with next session priorities
