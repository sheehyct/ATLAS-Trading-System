# Session Startup Prompt - EQUITY-52

**Previous Session:** EQUITY-51 (January 8-9, 2026)
**Current Branch:** `main`
**VPS Status:** Deployed with EQUITY-47 through EQUITY-51 changes

---

## Context

### What Was Accomplished (EQUITY-51)

**1. Trade Analytics Tests (18 tests):**
- Created `tests/test_dashboard/test_trade_analytics.py`
- Tests for empty input, single trades, multiple trades, missing fields, calculation accuracy
- Commit: `a59c384`

**2. VPS Deployment:**
- Deployed EQUITY-47 through EQUITY-51 to production
- Daemon restarted and running

**3. Pipeline Gap Analysis:**
- Mapped equity options pipeline (strat/signal_automation/)
- Mapped crypto pipeline (crypto/scanning/, crypto/simulation/)
- Identified 4 critical gaps in crypto pipeline

---

## EQUITY-52 Priorities (PLAN MODE RECOMMENDED)

### Critical Gaps to Address

| Priority | Gap | Equity Location | Effort |
|----------|-----|-----------------|--------|
| P1 | Stale setup validation | daemon.py:786-877 | 2-3 hrs |
| P2 | Type 3 pattern invalidation | position_monitor.py:1030-1056 | 3-4 hrs |
| P3 | TFC re-evaluation at entry | daemon.py:933-1056 | 2-3 hrs |
| P4 | Unified pattern detector usage | unified_pattern_detector.py | 1-2 hrs |

### Recommended Approach

1. **Enter Plan Mode** - Design shared execution validation architecture
2. **Create shared module** - `strat/execution/` with portable validation logic
3. **Port to crypto** - Import shared module in crypto pipeline
4. **Add cross-pipeline tests** - Verify both pipelines handle same edge cases

---

## Key Files

### Equity Pipeline (Source of Truth)
- `strat/signal_automation/daemon.py` - Stale setup, TFC re-eval
- `strat/signal_automation/position_monitor.py` - Type 3 invalidation, stale position
- `strat/signal_automation/entry_monitor.py` - Entry trigger detection
- `strat/unified_pattern_detector.py` - Pattern detection (should be shared)

### Crypto Pipeline (Needs Updates)
- `crypto/scanning/daemon.py` - Missing stale setup, TFC re-eval
- `crypto/simulation/position_monitor.py` - Missing Type 3 invalidation
- `crypto/scanning/entry_monitor.py` - Entry trigger detection
- `crypto/scanning/signal_scanner.py` - Uses older pattern detector

---

## Plan File

`C:\Users\sheeh\.claude\plans\quirky-tumbling-rabin.md`

---

## Mandatory Workflow

### During Development
1. **CLAUDE.md Section 2:** Invoke `strat-methodology` skill for ANY STRAT-related work
2. **CLAUDE.md Section 3:** Run tests before claiming functionality works

### Pre-Commit Checklist (BEFORE every commit)
- [ ] Run `/code-review` on changed files
- [ ] If touching trade execution code: Run `pr-review-toolkit:silent-failure-hunter`
- [ ] If adding new functionality: Run `pr-review-toolkit:pr-test-analyzer`
- [ ] Tests pass locally

### Session End Protocol
- [ ] Update docs/HANDOFF.md
- [ ] Update .session_startup_prompt.md
- [ ] Store session facts in OpenMemory
- [ ] Provide summary with next session priorities
