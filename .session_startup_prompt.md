# ATLAS STRAT Development - Session Startup

**Current Session:** 83K-81
**Last Session:** 83K-80 (December 12, 2025)
**Focus:** Dashboard P&L and Performance Tracking Enhancements

---

## Session 83K-80 Accomplishments

### HTF Scanning Architecture Fix (CRITICAL - DEPLOYED)

**Problem Solved:** SETUP patterns (2-1-?, 3-1-?) need LIVE entry when price breaks inside bar. Old schedule missed entries:
- Daily: 5 PM (move already over)
- Weekly: Friday 6 PM (5 days missed)
- Monthly: 28th (4 weeks missed)

**Solution:** 15-minute base resampling - scan every 15 min, resample to all HTFs

### First Live Test Run Observations

1. **Closed P&L Not Visible** - Alpaca only shows P&L on open positions
2. **Trade Progress to Target** - Placeholder never implemented
3. **Strategy Performance** - Needs STRAT Options tracking

---

## Session 83K-81 Priorities

### Priority 1: Closed Position P&L Tracking (HIGH)

**Problem:** Alpaca shows no P&L for closed trades - hard to track performance.

**Solution:** Use `/v2/account/activities/FILL` endpoint + FIFO matching

**Reference Script:** `C:\Users\sheeh\Downloads\TradeROI.py`

**Implementation:**
1. Add `get_closed_trades()` to `dashboard/data_loaders/options_loader.py`
2. Fetch FILL activities, FIFO match buys to sells
3. Calculate realized P&L and ROI per trade
4. Add "Closed Trades" tab/section to Options panel

**Key Fields:**
- symbol, buy_price, sell_price
- cost_basis_usd, realized_pnl_usd, roi_percent
- buy_time, sell_time

### Priority 2: Strategy Performance Tab Restructure (MEDIUM)

**Current:** Dropdown with 52-week momentum + ORB

**Target Structure:**
```
Strategy Performance Tab
├── Non-Options Strategies (future - keep as-is)
├── STRAT Options Performance (NEW - from closed trades)
└── Aggregate (NEW - all strategies combined)
```

**Depends on:** Priority 1 (needs closed P&L data)

### Priority 3: Trade Progress to Target (LOWER - DEFER)

**Challenge:** Need signal-to-position linkage for target prices
**Recommendation:** Complete P1 and P2 first

---

## Files to Modify

| File | Changes |
|------|---------|
| `dashboard/data_loaders/options_loader.py` | Add `get_closed_trades()` method |
| `dashboard/components/options_panel.py` | Add Closed Trades section |
| `dashboard/app.py` | Add callback for closed trades |
| `dashboard/components/strategy_panel.py` | Add STRAT Options + Aggregate views |

---

## VPS Status

| Component | Status | Notes |
|-----------|--------|-------|
| Signal Daemon | RUNNING | 15-min resampling active |
| Signal API | RUNNING | Port 5000 |
| Dashboard | AUTO-DEPLOYED | Railway |

## VPS Commands

```bash
ssh atlas@178.156.223.251
sudo systemctl status atlas-daemon
sudo journalctl -u atlas-daemon -f
```

---

## Plan Mode Recommendation

**PLAN MODE: ON** - Dashboard enhancements require coordinated changes across multiple files.

---

## OpenMemory References

- Session 83K-80: (see HANDOFF.md)
- Session 83K-78: `98f3c9dc-6f2a-4819-ab6e-131b8fb5a56c`
- Session 83K-77: `c9814c89-bcff-42ab-98f1-5fa30815228e`

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- Reference Script: `C:\Users\sheeh\Downloads\TradeROI.py`
- VPS Guide: `docs/VPS_GUIDE.md`
