# Session Startup Prompt - EQUITY-71

**Previous Session:** EQUITY-70 (January 18, 2026)
**Current Branch:** `main`
**VPS Status:** Daemon running, TFC REEVAL working correctly
**Plan Mode:** OFF - Test coverage continuation session

---

## EQUITY-70 Accomplishments

1. **Created tests/test_crypto/test_signal_scanner.py (78 tests):**
   - Maintenance window detection
   - ATR and volume ratio calculations
   - Bar sequence formatting
   - Pattern and setup detection (2-2, 3-2, 2-1-2, 3-1-2)
   - TFC evaluation and public scanning methods

2. **Created tests/test_crypto/test_sizing.py (30 tests):**
   - calculate_position_size with leverage capping
   - should_skip_trade conditions
   - calculate_stop_distance_for_leverage
   - calculate_position_size_leverage_first

3. **Created tests/test_crypto/test_state.py (48 tests):**
   - CryptoSystemState initialization
   - Bar classifications and data management
   - Account state tracking
   - Pattern management and continuity scoring
   - Veto checking and signal tracking

4. **Created tests/test_dashboard/test_smoke.py (56 tests):**
   - Module imports (22 tests)
   - Config validation (6 tests)
   - Theme verification (5 tests)
   - Data loader structure (7 tests)
   - Visualization modules (3 tests)
   - Component structure (3 tests)

5. **TFC risk_multiplier Bug - RESOLVED:**
   - Investigated signal_store.py, executor.py, paper_signal_scanner.py
   - Verified on VPS: signals have correct risk_multiplier (0.5 for TFC 3, 1.0 for TFC 4)
   - Bug was already fixed in EQUITY-42 (commit 16cd4e1)

---

## EQUITY-71 Priorities

### Priority 1: Continue Phase 3 Test Coverage

Remaining untested modules (36 remaining):
- `strat/signal_automation/` (entry_executor.py, exit_monitor.py, signal_store.py)
- `crypto/data/` (fetcher.py, indicators.py)
- `crypto/scanning/` (signal_store.py)
- `integrations/` (thetadata_options.py, tiingo_data_fetcher.py)

### Priority 2: Dashboard Functional Tests

Smoke tests complete - now add functional tests for:
- Data loader methods with mocked API responses
- Visualization functions with sample data
- Component callback logic

### Priority 3: God Class Refactoring (Phase 4)

7 classes over 1000 lines need attention:
- signal_scanner.py (1,296 lines)
- options_module.py (1,100+ lines)

---

## Technical Debt Summary (Post EQUITY-70)

| Category | Count | Status |
|----------|-------|--------|
| Crypto Pipeline Gaps | 1 | PENDING (MEDIUM - stale setup) |
| Untested Modules | 36 | IN PROGRESS (Phase 3) |
| God Classes (>1000 lines) | 7 | PENDING (Phase 4) |
| Missing Base Classes | 4 | PENDING (Phase 2) |

---

## Test Coverage Progress

| Module | Tests | Session |
|--------|-------|---------|
| `crypto/scanning/daemon.py` | 23 | EQUITY-68 |
| `crypto/simulation/position_monitor.py` | 25 | EQUITY-68 |
| `strat/paper_signal_scanner.py` | 50 | EQUITY-69 |
| `strat/options_module.py` | 41 | EQUITY-69 |
| `crypto/scanning/signal_scanner.py` | 78 | EQUITY-70 |
| `crypto/trading/sizing.py` | 30 | EQUITY-70 |
| `crypto/data/state.py` | 48 | EQUITY-70 |
| `dashboard/` (smoke tests) | 56 | EQUITY-70 |

**Phase 3 Total: 351 new tests (EQUITY-68 through EQUITY-70)**

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- CLAUDE.md: `docs/CLAUDE.md` (STRICT COMPLIANCE)
- Technical Debt Plan: `C:\Users\sheeh\.claude\plans\sharded-foraging-puppy.md`
