# ATLAS STRAT Development - Session Startup

**Current Session:** 83K-77
**Last Session:** 83K-76 (December 11, 2025)
**Focus:** CRITICAL BUG - Rapid Entry/Exit Investigation

---

## Session 83K-76 Accomplishments

### VPS Signal API - COMPLETE

| Component | Details |
|-----------|---------|
| Service | atlas-signal-api (systemd) |
| Port | 5000 |
| URL | http://178.156.223.251:5000/signals |
| Status | RUNNING |

**VPS Services:**
```bash
ssh atlas@178.156.223.251
sudo systemctl status atlas-daemon        # Signal scanner
sudo systemctl status atlas-signal-api    # API for dashboard
sudo journalctl -u atlas-daemon -f        # View daemon logs
```

### Dashboard Fixes - COMPLETE

1. Signal Pattern column now shows STRAT patterns (2U-2D, 3-2D)
2. Target/Stop prices now display correctly
3. P&L Summary uses live Alpaca position data
4. Trade Progress chart handles empty data gracefully

### Railway Environment Variable

Set `VPS_SIGNAL_API_URL=http://178.156.223.251:5000` in Railway.

---

## CRITICAL BUG DISCOVERED

### Issue: Rapid Entry/Exit within Seconds

Daemon entering trades and immediately exiting them:
- AAPL251219C00275000: Buy $4.10 -> Sell $4.05 in 12 seconds (-$5)
- QQQ251218P00620000: Buy $6.08 -> Sell $5.98 in 12 seconds (-$10)

**Evidence:** Alpaca order history shows buy at 11:30:06 AM, sell at 11:30:18 AM

### Potential Causes

1. **Position monitor exit conditions** - DTE/target/stop triggering on entry
2. **Duplicate signal processing** - Same signal executing multiple times
3. **HISTORICAL_TRIGGERED execution** - Completed patterns shouldn't execute

### Investigation Steps

1. Check VPS daemon logs: `sudo journalctl -u atlas-daemon --since "11:30" --until "11:35"`
2. Review `strat/signal_automation/position_monitor.py` exit conditions
3. Review `strat/signal_automation/executor.py` execution logic
4. Check signal status before execution

---

## Session 83K-77 Priorities

### Priority 1: CRITICAL - Fix Rapid Entry/Exit Bug

1. Pull VPS logs around 11:30 AM to see what triggered the exits
2. Review position_monitor.py exit condition thresholds
3. Ensure executor doesn't process HISTORICAL_TRIGGERED signals
4. Add safeguard: minimum hold time before position monitor activates

### Priority 2: Verify STRAT Pattern Accuracy

User will verify signal patterns match actual market data.

---

## Current System State

| Component | Status | Location |
|-----------|--------|----------|
| Signal Daemon | RUNNING | VPS (178.156.223.251) |
| Signal API | RUNNING | VPS :5000 |
| Dashboard | Railway | Connected to VPS API |
| Positions | 3 OPEN | SPY put, 2x IWM |

---

## Plan Mode Recommendation

**PLAN MODE: ON**

Critical bug investigation requires careful analysis before code changes.

---

## OpenMemory References

- Session 83K-76: (to be stored this session)
- Session 83K-75: `f3469960-1c23-4cf3-947a-ee89971b74c3`
- Session 83K-74: `feb563fe-1eba-489a-a7c8-4e24a7ca984d`

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- Position Monitor: `strat/signal_automation/position_monitor.py`
- Executor: `strat/signal_automation/executor.py`
- Daemon: `strat/signal_automation/daemon.py`
