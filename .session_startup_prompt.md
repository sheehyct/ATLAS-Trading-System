# ATLAS Development - Session Startup

**Current Session:** CRYPTO-11
**Last Session:** CRYPTO-10 (December 16, 2025)
**Focus:** Deploy fixes to VPS, monitor crypto daemon, live trading mode

---

## Session CRYPTO-10 Accomplishments

### STRAT Implementation Bug Fixes (COMPLETE)

Reviewed and merged Claude Code for Web branch `claude/review-daemon-strategy-T4kTM`.

**Bug 1: Live Bar as Setup Bar**
- Root cause: Signal scanner detected live bar as inside bar for 3-bar setups
- Fix: Exclude last bar from setup detection loops in signal_scanner.py
- Commit: `1b8e295`

**Bug 2: Incorrect Stop Placement**
- Root cause: 2-1-2 stops used inside bar (i-1) instead of first directional bar (i-2)
- Fix: Changed stops[i] = low[i-1] to low[i-2] in pattern_detector.py
- Commit: `1b8e295`

**Test Updates**
- Updated test expectations in test_pattern_detector.py for correct stop values
- All 297 STRAT tests passing
- Commit: `739f2df`

**Documentation Added**
- New file: `docs/Claude Skills/strat-methodology/IMPLEMENTATION-BUGS.md`
- Covers live bar detection, stop placement, entry mechanics
- Commit: `276d307`

---

## Session CRYPTO-11 Priorities

### Priority 1: Deploy to VPS (HIGH)

Push merged fixes to production. Restart crypto daemon.

```bash
ssh atlas@178.156.223.251
cd ~/vectorbt-workspace && git pull
sudo systemctl restart atlas-crypto-daemon
sudo systemctl status atlas-crypto-daemon
```

### Priority 2: Monitor Crypto Daemon (HIGH)

Verify no more same-candle entry/exit trades after fix.

**Watch for:**
- SETUP signals only from CLOSED bars
- Stops at first directional bar level, not inside bar
- No "entry and exit on same candle" behavior

### Priority 3: Live Trading Mode (MEDIUM)

Enable crypto execution (deferred from CRYPTO-7).

---

## TFC Settings Reference

```python
TIMEFRAMES = ["1w", "1d", "4h", "1h", "15m"]
VETO_TIMEFRAMES = ["1w", "1d"]
MIN_CONTINUITY_SCORE = 2  # Out of 4
```

TFC Score checks last closed bar classification on 1w, 1d, 4h, 1h.
Score 4 = all aligned, Score 2+ = trade allowed.

---

## Crypto Module Structure (v0.8.0)

```
crypto/
  __init__.py              # v0.8.0
  api/
    server.py              # Flask REST API (port 8080)
  config.py                # R:R now 1.0, leverage tiers
  scanning/
    models.py              # +prior_bar_type/high/low fields
    signal_scanner.py      # Populates prior bar info
    entry_monitor.py       # Bidirectional trigger detection
    daemon.py              # Uses actual_direction, passes tfc_score
  simulation/
    paper_trader.py        # +tfc_score field on SimulatedTrade
    position_monitor.py    # Stop/target monitoring
```

---

## Plan Mode Recommendation

**PLAN MODE: OFF** - Monitoring and operational work.

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- Entry Monitor: `crypto/scanning/entry_monitor.py` (check_triggers)
- Dashboard Panel: `dashboard/components/crypto_panel.py`
- Paper Trader: `crypto/simulation/paper_trader.py`

---

## Session Numbering

- **83K-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
