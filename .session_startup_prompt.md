# Session Startup Prompt - EQUITY-47

**Previous Session:** EQUITY-46 (January 7, 2026)
**Current Branch:** `main` at commit `79ff0d3`
**VPS Status:** Deployed with stale setup fix

---

## Context

### What Was Accomplished (EQUITY-46)

**Stale Setup Bug FIXED:**
- Added `_is_setup_stale()` method to daemon.py
- Integrated stale check into `_on_entry_triggered()` before execution
- 8 new tests added (all 37 signal automation tests pass)
- Deployed to VPS

**Root Cause:** The CRYPTO-MONITOR-2 fix (December 21) only validated setups at detection time. Stored signals were never revalidated, allowing stale setups (like MSTR 3-2U from Jan 5 triggering on Jan 7) to execute.

**Fix Logic:**
- 1H: Setup valid for 1 hour after setup_bar_timestamp
- 1D: Setup valid for 2 trading days (setup day + forming day)
- 1W: Setup valid for 2 weeks
- 1M: Setup valid for 2 months

---

## EQUITY-47 Priorities

### P1: TFC Logging (2 hrs)

**Goal:** Add logging to TFC evaluations in paper_signal_scanner.py

**The Problem:**
```python
# Lines 1197-1211: TFC evaluated but nothing logged
tfc_assessment = self.evaluate_tfc(symbol, timeframe, direction_int)
# NO LOGGING - cannot debug TFC filtering
```

**Implementation:**
1. Add logging after TFC evaluation showing score, alignment, passes_flexible
2. Add TFC breakdown to scan summary (passed vs failed counts)

**File:** `strat/paper_signal_scanner.py`

### P2: Filter Rejection Logging (1 hr)

**Goal:** Log why signals are rejected with actual vs threshold values

**File:** `strat/signal_automation/daemon.py` (`_passes_filters()` method)

---

## Architectural Discussion (For Future Reference)

The entry_monitor currently only receives current price. It cannot:
1. Detect Type 3 evolution (forming bar breaking both bounds)
2. Re-evaluate TFC at entry time

These are documented for P3 and P5 in the consolidated tech debt list.

---

## Key Files

- `strat/signal_automation/daemon.py` - Main daemon with stale setup fix
- `strat/paper_signal_scanner.py` - TFC evaluation (P1 target)
- `strat/signal_automation/entry_monitor.py` - Entry trigger monitoring
- `docs/HANDOFF.md` - Full session history

---

## Plan File

`C:\Users\sheeh\.claude\plans\twinkling-sauteeing-treehouse.md`

---

## Mandatory Workflow

1. **CLAUDE.md Section 2:** Invoke strat-methodology skill for ANY STRAT-related work
2. **CLAUDE.md Section 3:** Run tests before claiming functionality works
3. **Session End Protocol:** Update HANDOFF.md, session startup prompt, OpenMemory
