# ATLAS Development - Session Startup

**Current Session:** EQUITY-18
**Last Session:** EQUITY-17 (December 18, 2025)
**Focus:** Add 15m/30m/1H timeframe scanning to equity daemon

---

## Session EQUITY-17 Summary

### Key Fixes

1. **Discord Webhook Routing Fixed**
   - Equity alerts now go to trade-alerts channel (not crypto-alerts)
   - Added `DISCORD_EQUITY_WEBHOOK_URL` env var on VPS
   - Config updated in `strat/signal_automation/config.py`

2. **Merged Claude Web Bug Fixes**
   - Time filtering ("Let the Market Breathe")
   - Discord alerts on ALL execution paths
   - OSI symbol tracking for pattern correlation

3. **Premarket Analysis Script Created**
   - `scripts/premarket_pipeline_test.py` fetches live 15m data
   - Verified 11 signals sent to correct Discord channel

### Commits
- `6d4d420` - Merge Claude Web bug fixes
- `25d5142` - Discord equity webhook routing
- `f0e7ff4` - Premarket 15m data fetching

---

## Session EQUITY-18 Priority Tasks

| Priority | Task | Details |
|----------|------|---------|
| **HIGH** | 15m/30m/1H Scanning | Add faster timeframes to daemon for theoretical entries |
| Medium | Setup Validation | Add validation logic to equities scanner (consistency with crypto) |

---

## 15m/30m Scanning Design (READY TO IMPLEMENT)

### Data Fetching
- **15m/30m:** Use Alpaca direct fetch (code already in premarket script)
- **1H+:** Keep existing VBT fetch

### Schedule
```
15m: Scan at :00, :15, :30, :45 (every 15 min)
30m: Scan at :00, :30 (every 30 min)
1H:  Scan at :00 (every hour) - existing
```

### Time Filtering ("Let the Market Breathe")
```
15m 2-bar: 9:45 AM    15m 3-bar: 10:00 AM
30m 2-bar: 10:00 AM   30m 3-bar: 10:30 AM
1H 2-bar:  10:30 AM   1H 3-bar:  11:30 AM (existing)
```

### Files to Modify
1. `strat/paper_signal_scanner.py` - Add 15m/30m data fetching
2. `strat/signal_automation/config.py` - Add 15m/30m schedule config
3. `strat/signal_automation/daemon.py` - Add scan jobs for 15m/30m
4. `strat/signal_automation/entry_monitor.py` - Update time filtering

### Reference Code
See `scripts/premarket_pipeline_test.py` for Alpaca 15m fetch implementation.

---

## Setup Validation Enhancement (Optional)

**Context:** Crypto scanner has validation logic that equities lacks.

**What crypto has:**
```python
# For X-1 patterns: Valid if bars stay inside setup bar range
# For X-2 patterns: Valid if entry level NOT yet triggered
#   - LONG: valid if bar_high < entry_price
#   - SHORT: valid if bar_low > entry_price
```

**File:** `strat/paper_signal_scanner.py` around line 1075

**Reference:** See commit `79bffa9` in crypto scanner for validation logic.

**Priority:** Low - Not breaking anything, just consistency improvement.

---

## Key Files Reference

| File | Purpose |
|------|---------|
| `strat/paper_signal_scanner.py` | Equities pattern detection |
| `strat/signal_automation/daemon.py` | Signal daemon |
| `strat/signal_automation/config.py` | Schedule configuration |
| `scripts/premarket_pipeline_test.py` | Premarket 15m fetch (reference) |

---

## Session Numbering

- **EQUITY-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
