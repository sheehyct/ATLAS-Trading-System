# Session Startup Prompt - EQUITY-55

**Previous Session:** EQUITY-54 (January 11, 2026)
**Current Branch:** `main`
**VPS Status:** Bug fixes deployed, daemon running with TFC calculation enabled
**Plan Mode:** ON (retroactive TFC backfill is multi-file implementation)

---

## EQUITY-54 Bug Fixes Deployed

1. **CryptoDataLoader Fix** - Correct parameter (limit vs days) for get_closed_trades()
2. **TFC Calculation Fix** - Added evaluate_tfc() to scan_symbol_all_timeframes_resampled()

**Note:** Existing 352 signals still have `tfc_score=0`. New signals will have correct TFC.

---

## Priority 1: Retroactive TFC Backfill Script

**Goal:** Calculate TFC for all 34 historical closed trades to enable trade analysis.

**Create:** `scripts/backfill_trade_tfc.py`

**Algorithm:**
1. Read closed trades from Alpaca (entry timestamp, OSI symbol)
2. Extract underlying from OSI symbol (e.g., `AAPL250117C00250000` -> `AAPL`)
3. Fetch historical OHLC for underlying at entry time (1H, 1D, 1W, 1M)
4. Run `evaluate_tfc()` with direction from option type (CALL=bullish, PUT=bearish)
5. Match trade to signal store for pattern type (if available)
6. Output to `data/enriched_trades.json`

**Key components needed:**
- OSI symbol parser (exists in `options_loader._parse_occ_symbol()`)
- TFC evaluator (exists in `paper_signal_scanner.evaluate_tfc()`)
- Historical data fetcher (use Alpaca bars API)
- Signal store lookup (exists in `signal_store.get_signal_by_osi_symbol()`)

**Output includes summary stats:**
- Win rate WITH TFC >= 4 vs WITHOUT
- Avg P&L WITH TFC >= 4 vs WITHOUT
- Pattern breakdown

**Dashboard integration:**
- Modify `OptionsDataLoader.get_closed_trades()` to read from `enriched_trades.json`
- Fixes both TFC column AND pattern column

**API Note:** Alpaca Algo Trader Plus = 10,000 calls/minute (no rate limiting needed)

---

## Priority 2: Verify New Signal TFC Population

**Check on VPS (after Monday market activity):**
```bash
ssh atlas@178.156.223.251 "grep 'tfc_score' /home/atlas/vectorbt-workspace/data/signals/signals.json | grep -v 'tfc_score\": 0' | head -5"
```

If no non-zero TFC scores after Monday, investigate.

---

## Key Files for Implementation

| File | Purpose |
|------|---------|
| `scripts/backfill_trade_tfc.py` | NEW - Backfill script |
| `data/enriched_trades.json` | NEW - Output file |
| `dashboard/data_loaders/options_loader.py` | Modify to read enriched file |
| `strat/paper_signal_scanner.py` | Use evaluate_tfc() |
| `strat/signal_automation/signal_store.py` | Use get_signal_by_osi_symbol() |

---

## Mandatory Workflow

### During Development
1. **CLAUDE.md Section 2:** Invoke `strat-methodology` skill for ANY STRAT-related work
2. **CLAUDE.md Section 3:** Run tests before claiming functionality works

### Pre-Commit Checklist
- [ ] Run `/code-review` on changed files (for PRs)
- [ ] If touching trade execution: Run `pr-review-toolkit:silent-failure-hunter`
- [ ] Tests pass locally

### Session End Protocol
- [ ] Update docs/HANDOFF.md
- [ ] Update .session_startup_prompt.md
- [ ] Store session facts in OpenMemory
