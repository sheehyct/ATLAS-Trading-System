# ATLAS Development - Session Startup

**Current Session:** EQUITY-19
**Last Session:** EQUITY-18 (December 18, 2025)
**Focus:** FIX CRITICAL STRAT ENTRY LOGIC BUG

---

## CRITICAL BUG - MUST FIX FIRST

### The Problem

Our entry logic waits for bars to CLOSE before entering. This is **fundamentally wrong**.

### Core Concept: Every Bar Starts as "1"

When a new bar opens, it has no range yet (open = prior close). By definition, it's an inside bar ("1") until it breaks the prior bar's high or low.

### Correct Entry Logic for ALL Patterns

**The forming bar is always treated as "1" until it breaks.**

| Pattern Type | Setup (with forming bar) | Entry Trigger |
|--------------|--------------------------|---------------|
| **3-1-2** | 3-1-**1** | INSTANT bar breaks inside bar high (2U LONG) or low (2D SHORT) |
| **2U-1-2** | 2U-1-**1** | INSTANT bar breaks inside bar high (2U LONG) or low (2D SHORT) |
| **2D-1-2** | 2D-1-**1** | INSTANT bar breaks inside bar high (2U LONG) or low (2D SHORT) |
| **2U-2D** (reversal) | 2U-**1** | INSTANT bar breaks 2U bar's low (2D SHORT) |
| **2D-2U** (reversal) | 2D-**1** | INSTANT bar breaks 2D bar's high (2U LONG) |
| **2U-2U** (continuation) | 2U-**1** | INSTANT bar breaks 2U bar's high (2U LONG) |
| **2D-2D** (continuation) | 2D-**1** | INSTANT bar breaks 2D bar's low (2D SHORT) |
| **3-2U** | 3-**1** | INSTANT bar breaks outside bar's high (2U LONG) |
| **3-2D** | 3-**1** | INSTANT bar breaks outside bar's low (2D SHORT) |

### "Where is the next 2?"

This is the core STRAT concept:
1. We have a setup (closed bars + forming bar as implicit "1")
2. Watch the forming bar in real-time
3. Ask "where is the next 2?" - will it break up or down?
4. Enter the INSTANT it breaks (becomes 2U or 2D)

### What We Were Doing Wrong

1. Detecting CLOSED patterns (e.g., 2U-2D with both bars closed)
2. Then waiting for price to break the closed bar's extreme
3. This adds an extra bar of delay and misses the actual entry
4. Applied to ALL patterns - not just 3-1-2 and 2-2

### Implementation Notes

- Scanner should detect setups with forming bar as implicit "1"
- Entry monitor should watch for breaks during bar formation
- Do NOT wait for bar close to confirm pattern
- The break IS the confirmation AND the entry

### Files to Fix

1. `crypto/scanning/signal_scanner.py` - Detect setups (forming bar as "1")
2. `crypto/scanning/entry_monitor.py` - Monitor forming bar for break
3. `strat/paper_signal_scanner.py` - Same fixes for equities
4. `strat/signal_automation/entry_monitor.py` - Same fixes

---

## Session EQUITY-18 Accomplishments (Before Bug Discovery)

1. Added setup validation to equities scanner
2. Added 15m/30m timeframe scanning
3. Fixed crypto reversal setup validation
4. Set up automated premarket scanning cron job on VPS

### Commits
- `e631970` - feat(strat): add 15m/30m timeframe scanning support
- `b3968c1` - fix(scripts): premarket script timeframe fix
- `ae1cc3e` - fix(crypto): validate reversal setup failure

---

## Key Files Reference

| File | Purpose |
|------|---------|
| `crypto/scanning/signal_scanner.py` | Crypto pattern detection (NEEDS FIX) |
| `crypto/scanning/entry_monitor.py` | Crypto trigger monitoring (NEEDS FIX) |
| `strat/paper_signal_scanner.py` | Equities pattern detection (NEEDS FIX) |
| `strat/signal_automation/entry_monitor.py` | Equities trigger monitoring (NEEDS FIX) |

---

## Reference

- strat-methodology skill: Read EXECUTION.md and PATTERNS.md
- OpenMemory: Query "where is the next two?" and "entry logic"
- HANDOFF.md: Full bug description at top

---

## Session Numbering

- **EQUITY-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
