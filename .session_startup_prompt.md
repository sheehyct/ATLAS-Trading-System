# Session 83E Startup: Monte Carlo Simulation Implementation

**Date**: November 26, 2025
**Previous Session**: 83D (Walk-Forward Validation)
**Current Phase**: Options Module Phase 3 - ATLAS Compliance Validation
**Status**: Walk-forward validator complete, 222 STRAT/ThetaData + 44 validation tests passing

---

## Session Order Update (Multi-Session Implementation)

| Session | Phase | Focus | Status |
|---------|-------|-------|--------|
| 83A | - | ThetaData Stability Bug Fixes | COMPLETE |
| 83B | - | Expanded Comparison Testing | COMPLETE |
| 83C | 1 | Validation Framework Foundation | COMPLETE |
| 83D | 2 | Walk-Forward Validation | COMPLETE |
| 83E | 3 | Monte Carlo Simulation | **NEXT** |
| 83F | 4 | Bias Detection | PENDING |
| 83G | 5 | Pattern Metrics | PENDING |
| 83H | 6 | Options Risk Manager | PENDING |
| 83I | 7 | Integration | PENDING |
| 83J | 8 | Test Suite | PENDING |
| 83K | 9 | Validation Run | PENDING |

---

## Session 83E Mission

### Focus: Monte Carlo Simulation (ATLAS Checklist Section 1.7)

**File to Create:** `validation/monte_carlo.py` (~350 LOC)

**Requirements (from ATLAS Checklist):**
- 10,000 iterations (production standard)
- Bootstrap resampling with trade order randomization
- Options-specific: IV shock (+/- 20%), theta shock (up to 50% worse on losers)
- Acceptance criteria:
  - 95% CI for Sharpe does not include 0
  - P(Loss) < 20% (equities) / 30% (options)
  - P(Ruin >50% DD) < 5% (equities) / 10% (options)

**Key Components to Implement:**
1. `MonteCarloValidator` class
2. `validate()` method - main entry point
3. `_run_simulation()` - single simulation iteration
4. `_apply_options_shocks()` - IV and theta uncertainty
5. `_calculate_statistics()` - CI, P(Loss), P(Ruin)
6. Integration tests with synthetic trades

---

## Session 83D Accomplishments (Reference)

### Walk-Forward Validation (Complete)

Created `validation/walk_forward.py` (~420 LOC):

| Component | Purpose |
|-----------|---------|
| `WalkForwardValidator` | Main validator class |
| `FoldWindow` | Train/test window indices dataclass |
| `_generate_fold_windows()` | Rolling window fold generation |
| `_validate_fold()` | Per-fold optimization + OOS test |
| `_calculate_sharpe_degradation()` | IS vs OOS comparison |
| `_calculate_parameter_stability()` | CV per parameter |
| `calculate_sharpe_ratio()` | Standalone helper |
| `calculate_max_drawdown()` | Standalone helper |

**Tests Created:**
- `tests/test_validation/conftest.py` - Mock strategies, fixtures
- `tests/test_validation/test_walk_forward.py` - 44 tests ALL PASSING

---

## Key Files to Reference

| File | Purpose |
|------|---------|
| `validation/config.py` | MonteCarloConfig with ATLAS thresholds |
| `validation/results.py` | MonteCarloResults dataclass |
| `validation/walk_forward.py` | Reference for validator structure |
| `ATLAS_PRODUCTION_READINESS_CHECKLIST.md` | Section 1.7 - Monte Carlo spec |
| `C:\Users\sheeh\.claude\plans\jolly-stirring-wilkinson.md` | Full implementation plan |

---

## Quick Reference

### Run Tests
```bash
# Validation module imports
uv run python -c "from validation import WalkForwardValidator, MonteCarloConfig; print('OK')"

# Walk-forward tests
uv run pytest tests/test_validation/test_walk_forward.py -v

# STRAT tests
uv run pytest tests/test_strat/ -v
```

### Test Count
- 44 walk-forward validation tests passing
- 178 STRAT tests passing
- 222 total STRAT/ThetaData + validation tests passing

### ThetaData Terminal
- Port: 25503
- Status: Running

---

## Session Start Protocol

1. Read this file (current context)
2. Read `docs/HANDOFF.md` (Session 83D entry)
3. Read plan file at `C:\Users\sheeh\.claude\plans\jolly-stirring-wilkinson.md`
4. Query OpenMemory: "session 83D walk-forward validation"
5. Verify tests still passing before starting

## Session End Protocol

When done with Session 83E:
1. Commit monte_carlo.py with tests
2. Update HANDOFF.md with Session 83E entry
3. Store session facts in OpenMemory
4. Update this file for Session 83F (Bias Detection)
