# ATLAS Development - Session Startup

**Current Session:** CRYPTO-5
**Last Session:** CRYPTO-4 (December 13, 2025)
**Focus:** VPS deployment, entry monitor enhancement, Discord alerts

---

## Session CRYPTO-4 Accomplishments

### Intraday Leverage Configuration (COMPLETE)

Time-based leverage tier switching for Coinbase INTX perpetuals.

**Key Files:**
| File | Changes |
|------|---------|
| `crypto/config.py` | Intraday window config (6PM-4PM ET), helper functions |
| `crypto/__init__.py` | Export leverage helpers, bump to v0.4.0 |
| `crypto/scanning/daemon.py` | Time-based leverage in trade execution |

**Verified Working:**
```python
from crypto import is_intraday_window, get_max_leverage_for_symbol
# Intraday (10x): 6PM ET to 4PM ET next day
# Swing (4x): 4PM ET to 6PM ET (2-hour gap)
```

### VPS Deployment Infrastructure (COMPLETE)

CLI script and systemd service for production deployment.

**Files Created:**
| File | Purpose |
|------|---------|
| `scripts/run_crypto_daemon.py` | CLI entry point (~370 LOC) |
| `deploy/atlas-crypto-daemon.service` | systemd service file |

**CLI Commands:**
- `start` - Start daemon (24/7 mode)
- `scan` - Run single scan
- `status` - Show daemon status
- `positions` - Show paper trading positions
- `performance` - Show paper trading metrics
- `leverage` - Show current leverage tier
- `history` - Show trade history
- `reset` - Reset paper trading account

### Position Monitoring (COMPLETE)

Stop/target exit tracking for paper trades.

**Files Created:**
| File | Purpose |
|------|---------|
| `crypto/simulation/position_monitor.py` | CryptoPositionMonitor class (~250 LOC) |

**Integration:**
- Trades store stop_price, target_price, timeframe, pattern_type
- Health loop checks positions every 5 minutes
- Auto-close on stop loss or take profit

---

## Session CRYPTO-5 Priorities

### Priority 1: VPS Deployment Test (HIGH)

Deploy crypto daemon to VPS and verify 24/7 operation.

**Tasks:**
- Copy files to VPS (178.156.223.251)
- Install systemd service
- Verify daemon starts and runs
- Monitor logs for issues
- Test signal detection and paper trading

**VPS Commands:**
```bash
scp scripts/run_crypto_daemon.py atlas@178.156.223.251:~/vectorbt-workspace/scripts/
scp deploy/atlas-crypto-daemon.service atlas@178.156.223.251:~/
ssh atlas@178.156.223.251
sudo cp atlas-crypto-daemon.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable atlas-crypto-daemon
sudo systemctl start atlas-crypto-daemon
sudo journalctl -u atlas-crypto-daemon -f
```

### Priority 2: Entry Monitor Enhancement (MEDIUM)

More frequent position checks (60s instead of 5min).

**Tasks:**
- Move position checking from health loop to entry monitor
- Check positions on each poll cycle (60 seconds)
- Faster stop/target exits

### Priority 3: Discord Alerts (MEDIUM)

Add crypto signal alerts to existing Discord webhook.

**Tasks:**
- Create CryptoDiscordAlerter (similar to equities)
- Rich embeds for crypto signals
- Trigger notifications

### Priority 4: Dashboard Integration (LOW)

Add crypto paper trading to dashboard.

**Tasks:**
- Crypto positions panel
- P&L tracking
- Signal history

---

## Crypto Module Structure (v0.4.0)

```
crypto/
  __init__.py              # v0.4.0, exports leverage helpers
  config.py                # Intraday leverage window, helper functions
  exchange/
    coinbase_client.py     # Coinbase API (data + orders)
  data/
    state.py               # CryptoSystemState
  scanning/
    __init__.py
    models.py              # CryptoDetectedSignal, CryptoSignalContext
    signal_scanner.py      # CryptoSignalScanner
    entry_monitor.py       # CryptoEntryMonitor
    daemon.py              # CryptoSignalDaemon (time-based leverage)
  simulation/
    __init__.py            # Export CryptoPositionMonitor
    paper_trader.py        # Paper trading (stop/target fields)
    position_monitor.py    # Stop/target exit monitoring (NEW)
  trading/
    sizing.py              # Position sizing
    derivatives.py         # Funding, margin calculations
```

---

## Leverage Tiers Reference

| Tier | Leverage | Window (ET) | Use Case |
|------|----------|-------------|----------|
| Intraday | 10x | 6PM-4PM (22h) | Close before 4PM |
| Swing | 4x | 24/7 | Hold through funding |

**Note:** 4PM-6PM ET is swing-only (2-hour gap)

---

## Plan Mode Recommendation

**PLAN MODE: OFF** - VPS deployment is operational work.

---

## Reference Documents

- HANDOFF: `docs/HANDOFF.md`
- Crypto Config: `crypto/config.py`
- Daemon: `crypto/scanning/daemon.py`
- CLI: `scripts/run_crypto_daemon.py`
- systemd: `deploy/atlas-crypto-daemon.service`

---

## Session Numbering

- **83K-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
