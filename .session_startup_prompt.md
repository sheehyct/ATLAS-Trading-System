# ATLAS Development - Session Startup

**Current Session:** EQUITY-21
**Last Session:** EQUITY-20 (December 18, 2025)
**Focus:** MONITORING - Verify Entry Timing Fixes

---

## Session EQUITY-20 Accomplishments

### CRITICAL: Entry Timing Rule Added to CLAUDE.md

**Entry happens ON THE BREAK, not at bar close.**

- A forming bar is only "1" if it stays INSIDE prior range - NOT automatic
- Pre/post market gaps can complete patterns at open
- Scanner must include last CLOSED bar for bidirectional setups
- Entry monitor watches LIVE price for breaks

### Fixes Applied to Both Scanners

| Fix | Impact |
|-----|--------|
| Remove `last_bar_idx` exclusion from 3-2 setups | Detects setups on yesterday's bar |
| Remove `last_bar_idx` exclusion from 2-2 setups | Detects setups on yesterday's bar |
| Add `detect_outside_bar_setups_nb()` | Creates 3-? bidirectional setups |

### Documentation Updated

- `CLAUDE.md` v3.3 - Added Section 14 "STRAT Entry Timing (ZERO TOLERANCE)"
- `strat-methodology/SKILL.md` - Added "CRITICAL: Entry Timing" section
- `strat-methodology/EXECUTION.md` - Added "CRITICAL: Entry Timing" at top

### Test Results
- 297 STRAT tests passing
- 14 signal automation tests passing
- Both daemons deployed to VPS

### Commits
- `91ba645` - fix(strat): include last closed bar and 3-? setups for bidirectional detection
- `43b9a53` - fix(crypto): include last closed bar and 3-? setups for bidirectional detection

---

## Session EQUITY-21 Priorities

| Priority | Task | Details |
|----------|------|---------|
| **HIGH** | Monitor daemon logs | Verify bidirectional signals generating correctly |
| **HIGH** | Verify entry timing | Entries should happen on break, not bar close |
| Medium | Check executions | Verify orders are being submitted for new setups |

---

## Key Concept: Entry Timing (ZERO TOLERANCE)

**The most common implementation error: waiting for bar close.**

```
Scanner:
- Last bar in data = yesterday's CLOSED bar (NOT today's forming bar)
- Today's forming bar is NOT in the data - it's LIVE
- Create bidirectional setups based on last CLOSED bar

Entry Monitor:
- Watches LIVE price for breaks of trigger levels
- Entry is IMMEDIATE when price breaks, not at bar close

Example:
- Yesterday = 3 (H=$280, L=$273)
- Today opens at $271 (below $273)
- Today is ALREADY 2D at open (gap down)
- Pattern 3-2D COMPLETE at open - enter IMMEDIATELY
```

---

## Key Files Reference

| File | Purpose |
|------|---------|
| `strat/paper_signal_scanner.py` | Equities bidirectional setup detection |
| `crypto/scanning/signal_scanner.py` | Crypto bidirectional setup detection |
| `docs/CLAUDE.md` Section 14 | Entry timing rule |
| `strat-methodology/EXECUTION.md` | Full entry timing docs |

---

## Reference

- strat-methodology skill: EXECUTION.md "CRITICAL: Entry Timing" section
- CLAUDE.md Section 14: "STRAT Entry Timing (ZERO TOLERANCE)"
- OpenMemory: Query "entry timing bidirectional"
- HANDOFF.md: Full session history

---

## Session Numbering

- **EQUITY-XX** - Equities STRAT options work
- **CRYPTO-XX** - Crypto derivatives work
