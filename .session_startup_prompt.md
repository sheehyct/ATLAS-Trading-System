# Session 83K-20 Startup: Re-run Validation with Corrected Prices

**Date**: December 2025
**Previous Session**: 83K-19 (Price adjustment mismatch FIXED)
**Status**: READY FOR VALIDATION - Prices now aligned with ThetaData
**Plan Mode**: OFF - Implementation complete, ready to run validation

---

## Session 83K-19 Accomplishments

**CRITICAL BUG FIXED**: 6.9% price mismatch between equity data and ThetaData options.

### Solution Applied

1. **Alpaca**: Use `adjustment='split'` (removes dividend adjustments, keeps splits)
2. **Tiingo**: Use raw columns (`close` not `adjClose`)
3. **Data Source Priority**: Alpaca primary per CLAUDE.md

### Verification Results

| Source | Dec 23, 2020 | Diff from ThetaData |
|--------|--------------|---------------------|
| ThetaData underlying | $367.78 | baseline |
| Alpaca `adjustment='split'` | $367.49 | **0.08%** |
| Tiingo raw (`close`) | $367.57 | **0.06%** |

### Files Modified

- `integrations/tiingo_data_fetcher.py` - Use raw columns
- `validation/strat_validator.py` - Alpaca primary + adjustment='split'

---

## Session 83K-20 Priority: Re-run Validation

**Constraint:** ThetaData terminal was unstable in 83K-19 (many 500 errors).

### Tasks

1. **Verify ThetaData terminal stability** before running validation
2. **Clear any remaining cache** to ensure fresh unadjusted data
3. **Re-run SPY 3-1-2 validation** and verify:
   - Strike selections have correct moneyness (OTM should be OTM)
   - Entry deltas are ~0.40 (not 0.78 ITM)
4. **Run full validation matrix** if SPY looks good

---

## Commands

```bash
# Verify ThetaData terminal is running
uv run python -c "
from integrations.thetadata_client import ThetaDataRESTClient
client = ThetaDataRESTClient()
client.connect()
print('ThetaData connected!')
"

# Clear remaining cache (if needed)
rm -f data_cache/*.parquet
rm -f data/tiingo_cache/*.pkl

# Run SPY 3-1-2 validation
uv run python scripts/run_atlas_validation_83k.py \
    --batch 3-1-2 \
    --skip-symbols QQQ AAPL IWM DIA NVDA \
    --skip-timeframes 1W 1M

# Run tests
uv run pytest tests/test_validation/ -q
uv run pytest tests/test_strat/ -q
```

---

## Key Files

| File | Purpose |
|------|---------|
| `validation/strat_validator.py` | DataFetcher with Alpaca primary + adjustment='split' |
| `integrations/tiingo_data_fetcher.py` | Tiingo with raw columns |
| `scripts/run_atlas_validation_83k.py` | Validation runner |

---

## Expected Results After Fix

With properly aligned prices:
- Strike selections should target actual OTM options
- Entry deltas should be ~0.40 (OTM range) not 0.78 (ITM)
- Validation metrics should be more consistent
- Trade P&L should be more realistic
